# PKevo

Repo for Patrick Kaleta's MA thesis. Topic: Evolution & evaluation of polyketides
that bind to specified target receptors. Builds on work previously done by Robert Haas.

## Installation and requirements
ATM (version 0.4) this tool does not feature any fancy setup script, nor does it require an installation at all. In order to get it up and running, first make sure you're using Python 3.8 or higher. Then you can clone the repository onto your machine and install the 3rd-party packages found in the `requirements.txt` file (e.g. by installing them using pip: `pip install -r requirements.txt`).

## Running PKevo
PKevo is intended to be used as a Command line tool.

To run the application, you need to execute the provided `pkevo.py` file in a CLI window. `pkevo.py` serves as the main entry point of the application. The file is located inside the `/pkevo` directory and can be executed like this: `$ python pkevo.py [OPTIONAL SETTINGS]`. Parameters for the Grammatical Evolution can be set in `/pkevo/config/pkevo_config.py`, however the provided default settings should suffice for most needs. Some settings can be adjusted directly via the CLI execution command (see [wiki](https://krios.tbi.univie.ac.at/cheminfo/pkevo/-/wikis/Execution) for more information on that).

**Note**: This repository includes a tutorial (written as a Jupyter Notebook) that illustrates the usage and functionality of this app. In order for you to run and follow along the tutorial, you need to meet the requirements for PKevo (see above), as well as have Jupyter Notebook installed on your system.

## What PKevo does and (so far) doesn't do
Version 0.4 enables you to run an evolutionary simulation (using Grammatical Evolution), during which a Polyketide Synthase (PKS) domain string is constructed using the provided grammar rules. With the help of an external tool called [MØD](https://github.com/jakobandersen/mod), these PKS domain strings are translated into chemical molecules and then processed by another tool, called [LigandScout](https://docs.inteligand.com/ligandscout/), which performs docking simulations of these molecules onto a specified target pharmacophore. The results of these docking simulations are used by the Grammatical Evolution of PKevo for evaluating the fitness of each individual PKS domain string. 

Besides that, PKevo also enables the use of other pre-defined fitness functions like molecular fingerprint similarity or string distance (using [Levenshtein distance](https://en.wikipedia.org/wiki/Levenshtein_distance)). In addition to that, PKevo provides you with the possibility to add custom fitness functions using the provided template (for more on this please see the Wiki).

It is possible to define starting individuals for the initial generation of the GE simulation, however you need to provide the phenotype (which is in this case the PKS domain string), as well as the corresponding genome, so that the algorithm knows how this phenotype is constructed. The tool checks if provided phenotype and genome are a match (given the used grammar) and only then uses it for its initial generation. This leads to the limitation that you can only use starting individuals which were generated by this tool in previous runs, since that is the only way how to get the corresponding genome for a specific phenotype. Furthermore, the used grammar must be the same in both - the simulation you want to run and the simulation that was done previously in order to get the genome-phenotype combination. Otherwise, using a different grammar might lead to different phenotypes being produced by the given genomes.

By default the tool stores all generated results in the `/pkevo/simulation_results` folder and prints the most important information directly in the CLI as well. The tools behaviour for displaying and storing results can be adjusted in the configuration file and/or via command arguments (see Wiki for details).


## Important parameters
**Note:** a complete overview of all parameters can be found in the Wiki.
| Name    | Meaning |
| -------- | ------- |
| `TARGET_SEQUENCE` | The domain string used in the fitness function as reference. The algorithm will try to evolve towards this sequence. Note: Used only if `string_distance` is the selected fitness function.    |
| `TARGET_SMILES` | The Molecule's SMILES string used in the fitness function as reference. The algorithm will try to evolve towards this sequence. Note: Used only if `fingerprint_similarity` is the selected fitness function.   |
| `TARGET_PHARMACOPHORE_FILE` | Defines the **name** of the pharmacophore file, which should be used for the evaluation. Note: This file must reside inside `/pkevo/chemistry/chemistry_model_pharmacophores` |
| `GENERATIONS`    | Defines number of evolutionary cycles the algorithm will perform (between 20-50 is reasonable in v0.4) |
| `POPULATION_SIZE`    | Size of the initial population (between 50-150 is reasonable in v0.4) |
| `GENERATION_SIZE`    | Number of individuals that will be retained in each generation for the next run (makes sense to use same number as in `POPULATION_SIZE`)  |
| `SELECTION_STRATEGY` | Choose the selection strategy for selecting parent individuals |
| `REPLACEMENT_STRATEGY` | Choose the replacement strategy for populations |
| `CROSSOVER_OPERATOR` | Choose the crossover operation for offspring generation |

## Roadmap
**PKevo v0.2**: Goal is for the tool to no longer generate and evaluate domain string, but instead actual molecules using [MØD](https://github.com/jakobandersen/mod), which is essential for the following steps.

**PKevo v0.3**: The next step after that will be to use a proper fitness function that will evaluate how a polyketide binds to a specific receptor. For this an integration with [LigandScout](https://docs.inteligand.com/ligandscout/) will be implemented. After this point the app should be considered feature-complete, meaning no additional major features will be implemented for the first "public" release of version 1.0.

**PKevo v0.4 (aka v 1.0)**: Bringing it all together and final touches. At this point the tool should be ready for futher usage by others. 

## Run tests
Make sure you have [pytest](pytest.org) installed (install it using `pip install pytest` if necessary) and run `pytest` or `pytest --no-summary -s` while inside the app root directory or the `/tests` directory. Alternatively, you can also run specific test cases only with `pytest [NAME-OF-TEST-SCRIPT.py]`. Some tests can take quite some time to finish (e.g. fitness functions, which rely on external tools). To skip those tests, you can run `pytest -m "not long_running"`.


## Acknowledgements
As mentioned in the beginning, this project builds on and takes inspiration from previous work undertaken by Robert Haas. Certain functionality (like the communication with external tools or the graph plotting) have been taken from his unfinished code packages. This is also highlighted directly inside the respective Python files of this project.

Robert's code can be found under
`talax.tbi.univie.ac.at:/scratch/xtof/HAAS-PK` in the following 4 zip
files:

1. `roberthaas-panakeias-garden-4bb20827cf82.zip` main approaches and
   examples for polyketides (PKs) and non-ribosomal proteins (NRPs)

2. `roberthaas-unified-cheminformatics-5d3a6fd0473a.zip` wrapper methods
   for calling external programs such as ligandscout.

3. `roberthaas-unified-map-57c970a24367.zip`

4. `roberthaas-unified-plotting-fa81a7d4cbb1.zip`

Furthermore, [PonyGE2](https://github.com/ponyge/PonyGE2) was used as a starting point for the implementation of the Grammatical Evolution (GE), while mainly relying on the codebase of the [first version of PonyGE](https://github.com/jmmcd/ponyge).

This Master thesis project is supervised by [Prof. Christoph Flamm](https://ufind.univie.ac.at/de/person.html?id=17324).

